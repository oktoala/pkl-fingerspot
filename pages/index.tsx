import type { NextPage } from "next";
import Head from "next/head";
import styles from "../styles/Home.module.css";
import { useSession } from "next-auth/react";
import Router from "next/router";
import { pegawai, att_log } from "@prisma/client";

const Home: NextPage = (): JSX.Element => {
  const { status, data } = useSession({
    required: true,
    onUnauthenticated() {
      Router.replace("/login");
    },
  });
  const pegawaii = data?.pegawai as pegawai;
  const attendance = data?.attendances as att_log[];
  const months = [
    "Januari",
    "Februari",
    "Maret",
    "April",
    "Mei",
    "Juni",
    "Juli",
    "Agustus",
    "September",
    "Oktober",
    "November",
    "Desember",
  ];

  if (status === "loading") {
    return (
      <div className="flex justify-center items-center h-screen">
        <div
          className="w-12 h-12 rounded-full animate-spin
                    border-8 border-solid border-blue-700 border-t-transparent shadow-md"
        ></div>
      </div>
    );
  }

  return (
    <div className={styles.container}>
      <Head>
        <title>{pegawaii.pegawai_nama}</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <main className="">
        <div className="mt-2">
          <table className="border-collapse table-auto w-full text-sm">
            <thead>
              <tr>
                <th className="th">ID</th>
                <th className="th">Nama</th>
                <th className="th">Tanggal</th>
                <th className="th">UTC</th>
                <th className="th">Scan 1</th>
                <th className="th">Scan 2</th>
                <th className="th">Scan 3</th>
                <th className="th">Scan 4</th>
                <th className="th">Scan 5</th>
                <th className="th">Scan 6</th>
                <th className="th">Scan 7</th>
                <th className="th">Scan 8</th>
                <th className="th">Scan 9</th>
              </tr>
            </thead>
            <tbody className="bg-white ">
              {attendance.map((e, i) => {
                const index = i + 1;
                const date = new Date(e.scan_date);
                const tanggal = date.getDate();
                const bulan = months[date.getMonth()];
                const tahun = date.getFullYear();
                if (i < attendance.length-1) {
                  if (
                    tanggal === new Date(attendance[index].scan_date).getDate()
                  ) {
                    console.log("Sama");
                  }
                }
                return (
                  <tr key={i}>
                    <td className="td">{index}</td>
                    <td className="td">{pegawaii.pegawai_nama}</td>
                    <td className="td">
                      {tanggal}-{bulan}-{tahun}
                    </td>
                    <td className="td">{e.scan_date.toString()}</td>
                  </tr>
                );
              })}
            </tbody>
          </table>
        </div>
      </main>
    </div>
  );
};

export default Home;
